# Исправление ошибки 500 при GET /api/notifications

## Внесенные исправления:

### 1. Добавлена обработка ошибок в эндпоинте
- Обернут весь код в try-except
- Добавлена обработка ошибок преобразования отдельных уведомлений
- Возвращается понятное сообщение об ошибке

### 2. Улучшена обработка ошибок в сервисе
- Добавлен try-except в `get_notifications`
- Добавлено логирование ошибок с traceback
- Правильная обработка пустого результата (total = 0)

### 3. Исправлена модель ответа
- Исправлен alias для поля `metadata` в `NotificationResponse`
- Теперь правильно мапится с `event_metadata` в базе данных

## Возможные причины ошибки 500:

1. **База данных не инициализирована**
   - Решение: Убедитесь, что база данных создана (файл `notifications.db`)

2. **Таблица не существует**
   - Решение: Приложение должно автоматически создать таблицу при запуске через `init_db()`

3. **Проблема с преобразованием данных**
   - Решение: Теперь каждая запись обрабатывается отдельно с обработкой ошибок

4. **Проблема с enum или datetime**
   - Решение: Улучшена обработка преобразования типов

## Как проверить:

1. **Проверить health endpoint:**
   ```bash
   curl http://q84oskg0cs044ogwkok0os04.91.107.212.137.sslip.io/health
   ```

2. **Проверить получение уведомлений:**
   ```bash
   curl http://q84oskg0cs044ogwkok0os04.91.107.212.137.sslip.io/api/notifications
   ```

3. **Проверить статистику:**
   ```bash
   curl http://q84oskg0cs044ogwkok0os04.91.107.212.137.sslip.io/api/stats
   ```

## Важно:

⚠️ **Нужно перезапустить API сервер на Coolify**, чтобы изменения вступили в силу!

После перезапуска:
- Ошибки будут логироваться с подробностями
- При ошибке вернется понятное сообщение
- Пустая база данных вернет пустой список без ошибки

## Проверка логов:

Если ошибка все еще возникает, проверьте логи сервера на Coolify. Теперь они должны содержать подробную информацию об ошибке:
- Текст ошибки
- Traceback (полный стек вызовов)
- ID проблемного уведомления (если проблема в конкретной записи)


